# Goduino

> Write Arduino firmware in Go. Transpile to C++.

```go
package main

import (
    "arduino"
    "fmt"
)

func setup() {
    arduino.pinMode(13, arduino.OUTPUT)
    fmt.Println("Ready!")
}

func loop() {
    arduino.digitalWrite(13, arduino.HIGH)
    arduino.delay(500)
    arduino.digitalWrite(13, arduino.LOW)
    arduino.delay(500)
}
```

↓ transpiles to ↓

```cpp
// Generated by Goduino v0.1.0
#include <Arduino.h>

void setup() {
    pinMode(13, OUTPUT);
    Serial.println(String("Ready!"));
}

void loop() {
    digitalWrite(13, HIGH);
    delay(500);
    digitalWrite(13, LOW);
    delay(500);
}
```

---

## Architecture

```
goduino/
├── src/
│   ├── lexer/       — Go tokenizer
│   ├── parser/      — recursive-descent parser → AST
│   ├── transpiler/  — AST → Arduino C++ emitter
│   ├── runtime/     — package/builtin/board mappings
│   ├── error.rs     — unified error types
│   ├── lib.rs       — public API (Pipeline)
│   └── main.rs      — standalone binary
├── examples/        — sample .go sketches
└── docs/
    ├── CLI.md       — Go CLI specification
    └── UI.md        — IDE frontend specification
```

## Supported Go subset

| Feature | Status |
|---------|--------|
| Variables (`var`, `:=`) | ✅ |
| Constants (`const`) | ✅ |
| Functions + methods | ✅ |
| Structs + type aliases | ✅ |
| `if / else` | ✅ |
| `for` (C-style, while-style) | ✅ |
| `for … range` over arrays | ✅ |
| `switch / case` | ✅ |
| All operators | ✅ |
| String literals | ✅ |
| `import` + package calls | ✅ |
| Goroutines (`go`) | ⚠️ stub (comment emitted) |
| `defer` | ⚠️ stub (comment emitted) |
| Channels (`chan`) | ❌ not supported |
| Interfaces | ⚠️ type-only |
| Closures / lambdas | ⚠️ skeleton only |
| Multiple return values | ⚠️ struct pack |
| Generics | ❌ not planned |
| `map` type | ⚠️ void* stub |
| Garbage collection | ❌ (Arduino has no heap GC) |

## Mapped packages

| Go import | Maps to |
|-----------|---------|
| `"arduino"` | Arduino.h builtins |
| `"fmt"` | `Serial.print/println` |
| `"time"` | `delay / millis` |
| `"math"` | `<math.h>` functions |
| `"strconv"` | `String::to…` methods |
| `"wire"` / `"Wire"` | Wire.h (I2C) |
| `"spi"` / `"SPI"` | SPI.h |
| `"serial"` / `"Serial"` | Serial object |
| `"Servo"` | Servo.h |
| `"LiquidCrystal"` | LiquidCrystal.h |

## Supported boards

Run `goduino boards` for a full list:

| ID | Name | CPU |
|----|------|-----|
| `uno` | Arduino Uno | ATmega328P |
| `nano` | Arduino Nano | ATmega328P |
| `mega` | Arduino Mega 2560 | ATmega2560 |
| `esp32` | ESP32 Dev Module | Xtensa LX6 |
| `esp8266` | ESP8266 NodeMCU | ESP8266 |
| `pico` | Raspberry Pi Pico | RP2040 |
| `due` | Arduino Due | AT91SAM3X8E |
| … | … | … |

## Build

```bash
# Debug build
cargo build

# Release build (optimized + stripped)
cargo build --release

# Run tests
cargo test

# Transpile an example
cargo run -- examples/blink.go /tmp/blink.cpp --board uno
cat /tmp/blink.cpp
```

## Usage

```
goduino <input.go> [output.cpp] [FLAGS]

FLAGS:
    --board <id>     Target board (default: uno)
    --source-map     Emit #line pragmas for source mapping
    --version        Print version

COMMANDS:
    goduino boards   List supported boards
```

## Future: CLI & IDE

- **CLI** (`goduino` in Go): dependency management, project scaffolding,
  `build` / `flash` / `monitor` commands.
  → See [`docs/CLI.md`](docs/CLI.md) for full specification.

- **IDE** (React + Tauri + Monaco): browser-based editor with
  LSP support, serial monitor, board selector, live C++ preview.
  → See [`docs/UI.md`](docs/UI.md) for full specification.

## License

MIT